{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"/>
{% endblock %}

{% block content %}
<!-- Quick Action Bar -->
<div class="quick-action-bar sticky-top bg-white shadow-sm py-3 mb-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h4 class="mb-0 text-primary">₹{{ "{:,.0f}".format(property.price) }}</h4>
                <small class="text-muted">{{ property.property_type.typeName }} in {{ property.location.city }}</small>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-outline-primary me-2" onclick="toggleFavorite()">
                    <i class="bi bi-heart"></i> Save
                </button>
                <a href="#contact-form" class="btn btn-primary">Contact Owner</a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <!-- Property Images Gallery -->
            <div class="property-gallery mb-4">
                <div class="swiper property-swiper">
                    <div class="swiper-wrapper">
                        {% if property.images and property.images|length > 0 %}
                            {% for image in property.images %}
                            <div class="swiper-slide">
                                <a href="{{ url_for('static', filename='images/properties/' ~ property.propertyId ~ '/' ~ loop.index ~ '.jpg') }}" data-fancybox="gallery">
                                    <img src="{{ url_for('static', filename='images/properties/' ~ property.propertyId ~ '/' ~ loop.index ~ '.jpg') }}" 
                                         class="img-fluid w-100" 
                                         style="height: 500px; object-fit: cover; border-radius: 10px;"
                                         alt="{{ property.property_type.typeName }}">
                                </a>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="swiper-slide">
                                <img src="{{ url_for('static', filename='images/properties/1.jpg') }}" 
                                     class="img-fluid w-100" 
                                     style="height: 500px; object-fit: cover; border-radius: 10px;"
                                     alt="{{ property.property_type.typeName }}">
                            </div>
                        {% endif %}
                    </div>
                    <div class="swiper-pagination"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>

            <!-- Property Details -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">{{ property.property_type.typeName }} in {{ property.location.city }}</h3>
                        <span class="badge bg-primary">{{ property.listingType }}</span>
                    </div>
                    <p class="text-muted mb-0 mt-2">
                        <i class="bi bi-geo-alt"></i> {{ property.address }}
                    </p>
                </div>
                <div class="card-body">
                    <div class="price-section mb-4">
                        <h4 class="text-primary mb-0">₹{{ "{:,.0f}".format(property.price) }}</h4>
                        <small class="text-muted">{{ property.carpetArea }} sq.ft (₹{{ "{:,.0f}".format(property.price / property.carpetArea) }}/sq.ft)</small>
                    </div>
                    
                    <div class="property-highlights mb-4">
                        <div class="row g-3">
                            <div class="col-6 col-md-3">
                                <div class="highlight-item text-center p-3 rounded bg-light">
                                    <i class="bi bi-arrows-angle-expand mb-2"></i>
                                    <h6 class="mb-0">{{ property.carpetArea }} sq.ft</h6>
                                    <small class="text-muted">Carpet Area</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="highlight-item text-center p-3 rounded bg-light">
                                    <i class="bi bi-house-door mb-2"></i>
                                    <h6 class="mb-0">{{ property.furnishingType }}</h6>
                                    <small class="text-muted">Furnishing</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="highlight-item text-center p-3 rounded bg-light">
                                    <i class="bi bi-calendar-check mb-2"></i>
                                    <h6 class="mb-0">{{ property.propertyAge }}</h6>
                                    <small class="text-muted">Age</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="highlight-item text-center p-3 rounded bg-light">
                                    <i class="bi bi-building mb-2"></i>
                                    <h6 class="mb-0">{{ property.ownershipType }}</h6>
                                    <small class="text-muted">Ownership</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Amenities Section -->
                    {% include 'includes/amenities.html' %}
                    
                    <h5 class="mt-4 mb-3">About This Property</h5>
                    <p>Beautiful property located in prime location with all modern amenities. Close to schools, shopping centers, and public transport.</p>
                </div>
            </div>

            <!-- Location Map -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Location</h5>
                </div>
                <div class="card-body p-0">
                    <div id="map" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Contact Form -->
            <div class="card mb-4 contact-card" id="contact-form">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="owner-avatar mb-3">
                            <i class="bi bi-person-circle display-4"></i>
                        </div>
                        <h5 class="mb-1">{{ property.owner.username }}</h5>
                        <p class="text-muted small mb-3">Property Owner</p>
                        {% if property.owner.verified %}
                            <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Verified Owner</span>
                        {% endif %}
                    </div>
                    
                    <form class="contact-form">
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person"></i></span>
                                <input type="text" class="form-control" placeholder="Your Name">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                <input type="email" class="form-control" placeholder="Your Email">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-phone"></i></span>
                                <input type="tel" class="form-control" placeholder="Your Phone">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-chat"></i></span>
                                <textarea class="form-control" rows="4" placeholder="I'm interested in this property..."></textarea>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-send me-2"></i>Send Message
                            </button>
                            <a href="tel:{{ property.owner.mobile }}" class="btn btn-success btn-lg">
                                <i class="bi bi-telephone me-2"></i>Call Now
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
<script>
    // Initialize Fancybox
    Fancybox.bind("[data-fancybox]", {
        // Your custom options
    });

    // Initialize Swiper
    const swiper = new Swiper('.property-swiper', {
        slidesPerView: 1,
        spaceBetween: 30,
        loop: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
    });

    // Initialize map
    const map = L.map('map').setView([12.9716, 77.5946], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    L.marker([12.9716, 77.5946]).addTo(map);
</script>

<style>
.quick-action-bar {
    z-index: 1020;
}

.property-gallery {
    position: relative;
}

.property-swiper {
    --swiper-theme-color: #007bff;
    --swiper-navigation-size: 22px;
}

.swiper-button-next,
.swiper-button-prev {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
}

.swiper-pagination-bullet-active {
    background: var(--swiper-theme-color);
}

.contact-card {
    border: none;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    border-radius: 15px;
}

.owner-avatar {
    width: 80px;
    height: 80px;
    background: #f8f9fa;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #007bff;
}

.input-group-text {
    background: none;
    border-right: none;
}

.input-group .form-control {
    border-left: none;
}

.input-group .form-control:focus {
    border-color: #dee2e6;
    box-shadow: none;
}

.highlight-item {
    transition: transform 0.2s ease;
}

.highlight-item:hover {
    transform: translateY(-5px);
}

.highlight-item i {
    font-size: 1.5rem;
    color: var(--primary-color);
    display: block;
}
</style>
{% endblock %}